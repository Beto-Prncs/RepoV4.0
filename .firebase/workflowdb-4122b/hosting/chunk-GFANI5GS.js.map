{
  "version": 3,
  "sources": ["src/app/services/department.service.ts"],
  "sourcesContent": ["// src/app/services/department.service.ts\nimport { Injectable, inject } from '@angular/core';\nimport { \n  Firestore, \n  collection, \n  collectionData, \n  doc, \n  addDoc, \n  deleteDoc, \n  updateDoc, \n  query, \n  where, \n  getDocs \n} from '@angular/fire/firestore';\nimport { Observable, map, from, of } from 'rxjs';\nimport { Departamento } from '../models/interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DepartmentService {\n  private firestore: Firestore = inject(Firestore);\n\n  // Obtener todos los departamentos\n  getDepartments(): Observable<Departamento[]> {\n    const deptoRef = collection(this.firestore, 'Departamento');\n    return collectionData(deptoRef, { idField: 'IdDepartamento' })\n      .pipe(\n        map(departments => departments.map(dept => ({\n          IdDepartamento: dept['IdDepartamento'],\n          Nombre: dept['Nombre'],\n          id: dept['IdDepartamento'],\n          name: dept['Nombre']\n        })) as Departamento[])\n      );\n  }\n\n  // Añadir un nuevo departamento\n  async addDepartment(departmentName: string): Promise<string> {\n    try {\n      // Verificar si ya existe\n      const deptoRef = collection(this.firestore, 'Departamento');\n      const q = query(deptoRef, where('Nombre', '==', departmentName));\n      const querySnapshot = await getDocs(q);\n      \n      if (!querySnapshot.empty) {\n        throw new Error('Ya existe un departamento con este nombre');\n      }\n      \n      // Crear nuevo departamento con ID personalizado (nombre normalizado)\n      const id = departmentName.toLowerCase().trim().replace(/\\s+/g, '_');\n      const newDepartment = {\n        IdDepartamento: id,\n        Nombre: departmentName\n      };\n      \n      await addDoc(collection(this.firestore, 'Departamento'), newDepartment);\n      return id;\n    } catch (error) {\n      console.error('Error al añadir departamento:', error);\n      throw error;\n    }\n  }\n\n  // Eliminar un departamento\n  async deleteDepartment(departmentId: string): Promise<void> {\n    try {\n      // Verificar si hay usuarios asignados a este departamento\n      const usersRef = collection(this.firestore, 'Usuario');\n      const q = query(usersRef, where('Departamento', '==', departmentId));\n      const querySnapshot = await getDocs(q);\n      \n      if (!querySnapshot.empty) {\n        throw new Error('No se puede eliminar el departamento porque hay usuarios asignados a él');\n      }\n      \n      // Obtener la referencia del documento por ID\n      const deptoQuery = query(\n        collection(this.firestore, 'Departamento'),\n        where('IdDepartamento', '==', departmentId)\n      );\n      const deptoSnapshot = await getDocs(deptoQuery);\n      \n      if (deptoSnapshot.empty) {\n        throw new Error('Departamento no encontrado');\n      }\n      \n      // Eliminar el documento\n      await deleteDoc(doc(this.firestore, 'Departamento', deptoSnapshot.docs[0].id));\n    } catch (error) {\n      console.error('Error al eliminar departamento:', error);\n      throw error;\n    }\n  }\n}"],
  "mappings": "8LAoBA,IAAaA,GAAiB,IAAA,CAAxB,MAAOA,CAAiB,CACpBC,UAAuBC,EAAOC,CAAS,EAG/CC,gBAAc,CACZ,IAAMC,EAAWC,EAAW,KAAKL,UAAW,cAAc,EAC1D,OAAOM,EAAeF,EAAU,CAAEG,QAAS,gBAAgB,CAAE,EAC1DC,KACCC,EAAIC,GAAeA,EAAYD,IAAIE,IAAS,CAC1CC,eAAgBD,EAAK,eACrBE,OAAQF,EAAK,OACbG,GAAIH,EAAK,eACTI,KAAMJ,EAAK,QACX,CAAmB,CAAC,CAE5B,CAGMK,cAAcC,EAAsB,QAAAC,EAAA,sBACxC,GAAI,CAEF,IAAMd,EAAWC,EAAW,KAAKL,UAAW,cAAc,EACpDmB,EAAIC,EAAMhB,EAAUiB,EAAM,SAAU,KAAMJ,CAAc,CAAC,EAG/D,GAAI,EAFkB,MAAMK,EAAQH,CAAC,GAElBI,MACjB,MAAM,IAAIC,MAAM,2CAA2C,EAI7D,IAAMV,EAAKG,EAAeQ,YAAW,EAAGC,KAAI,EAAGC,QAAQ,OAAQ,GAAG,EAC5DC,EAAgB,CACpBhB,eAAgBE,EAChBD,OAAQI,GAGV,aAAMY,EAAOxB,EAAW,KAAKL,UAAW,cAAc,EAAG4B,CAAa,EAC/Dd,CACT,OAASgB,EAAO,CACdC,cAAQD,MAAM,mCAAiCA,CAAK,EAC9CA,CACR,CACF,GAGME,iBAAiBC,EAAoB,QAAAf,EAAA,sBACzC,GAAI,CAEF,IAAMgB,EAAW7B,EAAW,KAAKL,UAAW,SAAS,EAC/CmB,EAAIC,EAAMc,EAAUb,EAAM,eAAgB,KAAMY,CAAY,CAAC,EAGnE,GAAI,EAFkB,MAAMX,EAAQH,CAAC,GAElBI,MACjB,MAAM,IAAIC,MAAM,4EAAyE,EAI3F,IAAMW,EAAaf,EACjBf,EAAW,KAAKL,UAAW,cAAc,EACzCqB,EAAM,iBAAkB,KAAMY,CAAY,CAAC,EAEvCG,EAAgB,MAAMd,EAAQa,CAAU,EAE9C,GAAIC,EAAcb,MAChB,MAAM,IAAIC,MAAM,4BAA4B,EAI9C,MAAMa,EAAUC,EAAI,KAAKtC,UAAW,eAAgBoC,EAAcG,KAAK,CAAC,EAAEzB,EAAE,CAAC,CAC/E,OAASgB,EAAO,CACdC,cAAQD,MAAM,kCAAmCA,CAAK,EAChDA,CACR,CACF,8CAzEW/B,EAAiB,6BAAjBA,EAAiByC,QAAjBzC,EAAiB0C,UAAAC,WAFhB,MAAM,CAAA,SAEP3C,CAAiB,GAAA",
  "names": ["DepartmentService", "firestore", "inject", "Firestore", "getDepartments", "deptoRef", "collection", "collectionData", "idField", "pipe", "map", "departments", "dept", "IdDepartamento", "Nombre", "id", "name", "addDepartment", "departmentName", "__async", "q", "query", "where", "getDocs", "empty", "Error", "toLowerCase", "trim", "replace", "newDepartment", "addDoc", "error", "console", "deleteDepartment", "departmentId", "usersRef", "deptoQuery", "deptoSnapshot", "deleteDoc", "doc", "docs", "factory", "\u0275fac", "providedIn"]
}
