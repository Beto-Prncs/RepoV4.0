import{a as z}from"./chunk-HMRK7SWW.js";import"./chunk-NOIAGMWN.js";import{a as T,b as k}from"./chunk-MPPYJNLS.js";import{b as j,d as A,e as G,f as B,g as D,h as H,s as q}from"./chunk-QFMXGRBX.js";import"./chunk-7XAWW6QG.js";import{c as L,e as I,k as F,s as N,u as W}from"./chunk-OLDY7IAS.js";import{Ab as u,Bb as C,Eb as f,Fb as d,Mb as a,Nb as O,Ob as S,Qb as b,Rb as P,Sb as M,Ta as s,Vb as E,Ya as v,bb as R,ga as p,gb as h,ha as g,ia as _,ja as x,ob as c,pb as V,qb as y,yb as t,zb as i}from"./chunk-GCXAMRXK.js";import{g as w}from"./chunk-OIKEWKHE.js";var Y=(o,m)=>({error:o,success:m});function K(o,m){if(o&1&&(t(0,"div",12),a(1),i()),o&2){let e=d(2);c("ngClass",E(2,Y,e.messageType==="error",e.messageType==="success")),s(),S(" ",e.message," ")}}function Q(o,m){o&1&&(t(0,"span"),a(1,"Enviar instrucciones"),i())}function U(o,m){o&1&&(t(0,"span",13),_(),t(1,"svg",14),u(2,"circle",15),i(),a(3," Enviando... "),i())}function Z(o,m){if(o&1){let e=C();t(0,"div")(1,"p"),a(2,"Ingresa tu correo electr\xF3nico para recibir instrucciones de recuperaci\xF3n"),i(),h(3,K,2,5,"div",6),t(4,"form",7)(5,"label"),a(6,"Correo electr\xF3nico"),i(),t(7,"input",8),M("ngModelChange",function(r){p(e);let l=d();return P(l.email,r)||(l.email=r),g(r)}),i(),t(8,"button",9),f("click",function(){p(e);let r=d();return g(r.sendRecoveryEmail())}),h(9,Q,2,0,"span",5)(10,U,4,0,"span",10),i(),t(11,"button",11),f("click",function(){p(e);let r=d();return g(r.goToLogin())}),a(12," Volver al inicio de sesi\xF3n "),i()()()}if(o&2){let e=d();s(3),c("ngIf",e.message),s(4),y("input-error",e.messageType==="error"),b("ngModel",e.email),s(),c("disabled",e.isLoading||!e.email),s(),c("ngIf",!e.isLoading),s(),c("ngIf",e.isLoading)}}function J(o,m){if(o&1){let e=C();t(0,"div")(1,"div",16),_(),t(2,"svg",17),u(3,"path",18)(4,"path",19),i()(),x(),t(5,"h2"),a(6,"Correo enviado"),i(),t(7,"p"),a(8,"Hemos enviado instrucciones para recuperar tu contrase\xF1a a "),t(9,"strong"),a(10),i()(),t(11,"p"),a(12,"Revisa tu bandeja de entrada y sigue las instrucciones en el correo."),i(),t(13,"button",20),f("click",function(){p(e);let r=d();return g(r.goToLogin())}),a(14," Volver al inicio de sesi\xF3n "),i()()}if(o&2){let e=d();s(10),O(e.email)}}function X(o,m){if(o&1&&(t(0,"div",12),a(1),i()),o&2){let e=d(2);c("ngClass",E(2,Y,e.messageType==="error",e.messageType==="success")),s(),S(" ",e.message," ")}}function $(o,m){o&1&&(t(0,"span"),a(1,"Cambiar contrase\xF1a"),i())}function ee(o,m){o&1&&(t(0,"span",13),_(),t(1,"svg",14),u(2,"circle",15),i(),a(3," Procesando... "),i())}function te(o,m){if(o&1){let e=C();t(0,"div")(1,"h2"),a(2,"Establece una nueva contrase\xF1a"),i(),h(3,X,2,5,"div",6),t(4,"form",7)(5,"label"),a(6,"Nueva contrase\xF1a"),i(),t(7,"div",21)(8,"input",22),M("ngModelChange",function(r){p(e);let l=d();return P(l.newPassword,r)||(l.newPassword=r),g(r)}),i(),t(9,"button",23),f("click",function(){p(e);let r=d();return g(r.togglePasswordVisibility())}),_(),t(10,"svg",17),u(11,"path",24)(12,"circle",25)(13,"path",26),i()()(),x(),t(14,"label"),a(15,"Confirmar contrase\xF1a"),i(),t(16,"input",27),M("ngModelChange",function(r){p(e);let l=d();return P(l.confirmPassword,r)||(l.confirmPassword=r),g(r)}),i(),t(17,"button",9),f("click",function(){p(e);let r=d();return g(r.resetPassword())}),h(18,$,2,0,"span",5)(19,ee,4,0,"span",10),i()()()}if(o&2){let e=d();s(3),c("ngIf",e.message),s(5),y("input-error",e.messageType==="error"),c("type",e.showPassword?"text":"password"),b("ngModel",e.newPassword),s(5),V("display",e.showPassword?"inline":"none"),s(3),y("input-error",e.messageType==="error"),b("ngModel",e.confirmPassword),s(),c("disabled",e.isLoading||!e.newPassword||!e.confirmPassword),s(),c("ngIf",!e.isLoading),s(),c("ngIf",e.isLoading)}}function ne(o,m){if(o&1){let e=C();t(0,"div")(1,"div",16),_(),t(2,"svg",17),u(3,"path",18)(4,"path",19),i()(),x(),t(5,"h2"),a(6,"\xA1Contrase\xF1a actualizada!"),i(),t(7,"p"),a(8,"Tu contrase\xF1a ha sido cambiada exitosamente."),i(),t(9,"button",20),f("click",function(){p(e);let r=d();return g(r.goToLogin())}),a(10," Iniciar sesi\xF3n "),i()()}}var me=(()=>{class o{authService;router;route;step=1;isLoading=!1;message="";messageType="error";email="";newPassword="";confirmPassword="";showPassword=!1;actionCode="";constructor(e,n,r){this.authService=e,this.router=n,this.route=r}ngOnInit(){this.route.queryParams.subscribe(e=>{let n=e.oobCode;e.mode==="resetPassword"&&n&&(this.actionCode=n,this.step=3,this.verifyActionCode(n))})}verifyActionCode(e){return w(this,null,function*(){this.isLoading=!0,this.message="";try{let n=yield this.authService.verifyPasswordResetCode(e);this.email=n,this.isLoading=!1}catch(n){console.error("Error verificando c\xF3digo:",n),this.message="El enlace ha expirado o no es v\xE1lido. Por favor, solicita un nuevo correo de recuperaci\xF3n.",this.messageType="error",this.isLoading=!1,setTimeout(()=>{this.step=1},3e3)}})}sendRecoveryEmail(){return w(this,null,function*(){if(!this.email){this.message="Por favor, ingresa tu correo electr\xF3nico",this.messageType="error";return}this.isLoading=!0,this.message="";try{let e=T(),l=(yield k(e,"sendPasswordResetEmail")({email:this.email})).data;if(l&&l.success)this.step=2;else throw new Error("Error al enviar el correo de recuperaci\xF3n")}catch(e){console.error("Error al enviar correo:",e);let n="Error al enviar el correo. Verifica que el correo electr\xF3nico sea correcto.";e.data&&e.data.message?n=e.data.message:e.message?n=e.message:e.details&&e.details.message&&(n=e.details.message),(e.code==="functions/not-found"||e.details&&e.details.code==="not-found")&&(n="No existe una cuenta con este correo electr\xF3nico."),this.message=n,this.messageType="error"}finally{this.isLoading=!1}})}resetPassword(){return w(this,null,function*(){if(!this.newPassword||!this.confirmPassword){this.message="Por favor, completa todos los campos",this.messageType="error";return}if(this.newPassword!==this.confirmPassword){this.message="Las contrase\xF1as no coinciden",this.messageType="error";return}if(this.newPassword.length<6){this.message="La contrase\xF1a debe tener al menos 6 caracteres",this.messageType="error";return}this.isLoading=!0,this.message="";try{yield this.authService.confirmPasswordReset(this.actionCode,this.newPassword);let e=T(),l=(yield k(e,"afterPasswordReset")({email:this.email,newPassword:this.newPassword})).data;if(l&&l.success)this.step=4;else throw new Error("Error al actualizar la contrase\xF1a en la base de datos")}catch(e){console.error("Error al cambiar la contrase\xF1a:",e);let n="Error al cambiar la contrase\xF1a. Por favor, intenta nuevamente.";e.data&&e.data.message?n=e.data.message:e.message?n=e.message:e.details&&e.details.message&&(n=e.details.message),this.message=n,this.messageType="error"}finally{this.isLoading=!1}})}goToLogin(){this.router.navigate(["/login"])}togglePasswordVisibility(){this.showPassword=!this.showPassword}static \u0275fac=function(n){return new(n||o)(v(z),v(W),v(N))};static \u0275cmp=R({type:o,selectors:[["app-recuperar-contrasena"]],decls:10,vars:4,consts:[[1,"container"],[1,"card"],["src","icons/logo_Repo.png","alt","Logo de la Aplicaci\xF3n",1,"app-logo"],[1,"card-header"],[1,"card-body"],[4,"ngIf"],["class","message",3,"ngClass",4,"ngIf"],[1,"reset-form"],["type","email","placeholder","Ingresa tu correo","name","email",3,"ngModelChange","ngModel"],["type","button",1,"auth-button-primary",3,"click","disabled"],["class","loader-container",4,"ngIf"],["type","button",1,"auth-button-secondary",3,"click"],[1,"message",3,"ngClass"],[1,"loader-container"],["viewBox","0 0 50 50",1,"spinner"],["cx","25","cy","25","r","20","fill","none","stroke-width","5",1,"path"],[1,"success-icon"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["d","M22 11.08V12a10 10 0 11-5.93-9.14"],["d","M22 4L12 14.01l-3-3"],["type","button",1,"auth-button-primary",3,"click"],[1,"password-input"],["placeholder","Nueva contrase\xF1a","name","newPassword",3,"ngModelChange","type","ngModel"],["type","button",1,"toggle-password",3,"click"],["d","M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"],["cx","12","cy","12","r","3"],["d","M3 3l18 18"],["type","password","placeholder","Confirmar contrase\xF1a","name","confirmPassword",3,"ngModelChange","ngModel"]],template:function(n,r){n&1&&(t(0,"div",0)(1,"div",1),u(2,"img",2),t(3,"div",3),a(4,"Recuperaci\xF3n de Contrase\xF1a"),i(),t(5,"div",4),h(6,Z,13,7,"div",5)(7,J,15,1,"div",5)(8,te,20,13,"div",5)(9,ne,11,0,"div",5),i()()()),n&2&&(s(6),c("ngIf",r.step===1),s(),c("ngIf",r.step===2),s(),c("ngIf",r.step===3),s(),c("ngIf",r.step===4))},dependencies:[F,L,I,q,H,j,A,G,D,B],styles:[`.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;background-color:#f5f7fa;padding:1rem}.card[_ngcontent-%COMP%]{width:100%;max-width:400px;background:#fff;border-radius:10px;box-shadow:0 4px 10px #0000001a;padding:2rem;text-align:center}.app-logo[_ngcontent-%COMP%]{width:120px;margin-bottom:1rem}.card-header[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;margin-bottom:.5rem;color:#333}.card-body[_ngcontent-%COMP%]{margin-top:1rem}.reset-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;margin-top:1.5rem}label[_ngcontent-%COMP%]{text-align:left;font-size:.9rem;color:#555;margin-bottom:-.5rem}input[_ngcontent-%COMP%]{padding:.8rem 1rem;border:1px solid #ddd;border-radius:4px;font-size:1rem;width:100%}input.input-error[_ngcontent-%COMP%]{border-color:#e53935}.message[_ngcontent-%COMP%]{padding:.8rem;border-radius:4px;margin-top:1rem}.message.error[_ngcontent-%COMP%]{background-color:#ffebee;color:#c62828;border:1px solid #ffcdd2}.message.success[_ngcontent-%COMP%]{background-color:#e8f5e9;color:#2e7d32;border:1px solid #c8e6c9}.auth-button-primary[_ngcontent-%COMP%]{padding:.8rem;border-radius:4px;font-size:1rem;cursor:pointer;transition:background-color .3s;background-color:#3f51b5;color:#fff;border:none}.auth-button-primary[_ngcontent-%COMP%]:hover{background-color:#303f9f}.auth-button-primary[_ngcontent-%COMP%]:disabled{background-color:#c5cae9;cursor:not-allowed}.auth-button-secondary[_ngcontent-%COMP%]{padding:.8rem;border-radius:4px;font-size:1rem;cursor:pointer;transition:background-color .3s;background-color:transparent;color:#3f51b5;border:1px solid #3f51b5}.auth-button-secondary[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.loader-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px}.spinner[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_rotate 2s linear infinite;width:20px;height:20px}.path[_ngcontent-%COMP%]{stroke:#fff;stroke-linecap:round;animation:_ngcontent-%COMP%_dash 1.5s ease-in-out infinite}@keyframes _ngcontent-%COMP%_rotate{to{transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_dash{0%{stroke-dasharray:1,150;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-35}to{stroke-dasharray:90,150;stroke-dashoffset:-124}}.success-icon[_ngcontent-%COMP%]{width:80px;height:80px;margin:0 auto 1.5rem;color:#4caf50}.success-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:100%;height:100%}h2[_ngcontent-%COMP%]{margin-bottom:1rem;color:#333}.password-input[_ngcontent-%COMP%]{position:relative;width:100%}.toggle-password[_ngcontent-%COMP%]{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:#777;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center}.toggle-password[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}
/*# sourceMappingURL=recuperar-contrasena.component-ZPYQI62K.css.map */`]})}return o})();export{me as RecuperarContrasenaComponent};
//# sourceMappingURL=chunk-EMDJ3DKI.js.map
