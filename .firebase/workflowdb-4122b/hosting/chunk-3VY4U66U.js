import{a as Y,d as Q,f as q,h as D}from"./chunk-BXWCDTY3.js";import{a as B}from"./chunk-HMRK7SWW.js";import"./chunk-NOIAGMWN.js";import{K as z,Q as N,W as L}from"./chunk-7XAWW6QG.js";import{e as I,f as A,k as U,r as T,t as V,u as W,v as F,y as j}from"./chunk-OLDY7IAS.js";import{A as P,Ab as d,Bb as w,Eb as p,Fb as g,Ib as O,Jb as S,Kb as R,Mb as a,Nb as k,Oa as y,Ob as C,Ta as l,Vb as E,Ya as v,bb as M,ga as c,gb as _,ha as m,ob as u,qb as x,yb as i,zb as n}from"./chunk-GCXAMRXK.js";import"./chunk-OIKEWKHE.js";var X=["fileInput"],G=(s,h)=>({right:s,transform:h});function $(s,h){if(s&1&&(i(0,"div",28)(1,"p",29),a(2,"Bienvenido,"),n(),i(3,"span",30),a(4),n()()),s&2){let e=g();l(3),u("title",e.usuario.Nombre),l(),C(" ",e.usuario.Nombre," ")}}function H(s,h){s&1&&(i(0,"div",28)(1,"p",29),a(2,"Cargando..."),n()())}function J(s,h){s&1&&(i(0,"div",50),d(1,"div",51),n())}function K(s,h){if(s&1){let e=w();i(0,"div",31)(1,"div",32)(2,"div",33),d(3,"img",34),_(4,J,2,0,"div",35),i(5,"button",36),p("click",function(){c(e);let t=g();return m(t.openPhotoSelector())}),d(6,"i",37),i(7,"span"),a(8,"Cambiar foto"),n()(),i(9,"input",38,0),p("change",function(t){c(e);let o=g();return m(o.onPhotoSelected(t))}),n()(),i(11,"div",39)(12,"p",40),a(13),n(),i(14,"span",41),a(15),n(),i(16,"p",42),a(17),n()()(),i(18,"div",43)(19,"a",44),p("click",function(){c(e);let t=g();return m(t.navigateTo("/configuration"))}),d(20,"i",45),i(21,"span",46),a(22,"Configuraci\xF3n"),n()(),d(23,"hr",47),i(24,"a",48),p("click",function(){c(e);let t=g();return m(t.logout())}),d(25,"i",49),i(26,"span",46),a(27,"Cerrar Sesi\xF3n"),n()()()()}if(s&2){let e=g();u("ngStyle",E(9,G,e.window.innerWidth<640?"50%":"0",e.window.innerWidth<640?"translateX(50%)":"none")),l(2),x("opacity-70",e.isUploading),l(),u("src",e.usuario&&e.usuario.Foto_Perfil?e.usuario.Foto_Perfil:"icons/default_profile.png",y),l(),u("ngIf",e.isUploading),l(),u("disabled",e.isUploading),l(8),k(e.usuario==null?null:e.usuario.Nombre),l(2),C(" ",e.usuario==null?null:e.usuario.Rol," "),l(2),k(e.usuario==null?null:e.usuario.Correo)}}function Z(s,h){if(s&1){let e=w();i(0,"div",52)(1,"div",53)(2,"a",54),p("click",function(){c(e);let t=g();return m(t.navigateTo("/worker"))}),d(3,"i",55),i(4,"span"),a(5,"Inicio"),n()(),i(6,"a",56),p("click",function(){c(e);let t=g();return m(t.navigateTo("/worker-pendingtask"))}),d(7,"i",57),i(8,"span"),a(9,"Reportes Pendientes"),n()(),i(10,"a",58),p("click",function(){c(e);let t=g();return m(t.navigateTo("/worker-completetask"))}),d(11,"i",59),i(12,"span"),a(13,"Trabajos Completos"),n()(),i(14,"a",60),p("click",function(){c(e);let t=g();return m(t.navigateTo("/worker-statistics"))}),d(15,"i",61),i(16,"span"),a(17,"Estad\xEDsticas"),n()()()()}if(s&2){let e=g();l(2),x("bg-indigo-600",e.isActiveRoute("/worker"))("text-white",e.isActiveRoute("/worker"))("bg-gray-100",!e.isActiveRoute("/worker"))("text-gray-700",!e.isActiveRoute("/worker"))("hover:bg-indigo-500",e.isActiveRoute("/worker"))("hover:bg-gray-200",!e.isActiveRoute("/worker")),l(4),x("bg-indigo-600",e.isActiveRoute("/worker-pendingtask"))("text-white",e.isActiveRoute("/worker-pendingtask"))("bg-gray-100",!e.isActiveRoute("/worker-pendingtask"))("text-gray-700",!e.isActiveRoute("/worker-pendingtask"))("hover:bg-indigo-500",e.isActiveRoute("/worker-pendingtask"))("hover:bg-gray-200",!e.isActiveRoute("/worker-pendingtask")),l(4),x("bg-indigo-600",e.isActiveRoute("/worker-completetask"))("text-white",e.isActiveRoute("/worker-completetask"))("bg-gray-100",!e.isActiveRoute("/worker-completetask"))("text-gray-700",!e.isActiveRoute("/worker-completetask"))("hover:bg-indigo-500",e.isActiveRoute("/worker-completetask"))("hover:bg-gray-200",!e.isActiveRoute("/worker-completetask")),l(4),x("bg-indigo-600",e.isActiveRoute("/worker-statistics"))("text-white",e.isActiveRoute("/worker-statistics"))("bg-gray-100",!e.isActiveRoute("/worker-statistics"))("text-gray-700",!e.isActiveRoute("/worker-statistics"))("hover:bg-indigo-500",e.isActiveRoute("/worker-statistics"))("hover:bg-gray-200",!e.isActiveRoute("/worker-statistics"))}}function ee(s,h){s&1&&(i(0,"div",62),d(1,"div",63),i(2,"p",64),a(3,"Cargando dashboard..."),n()())}var ue=(()=>{class s{router;authService;storage;firestore;fileInput;usuario=null;isProfileMenuOpen=!1;isLoading=!0;isUploading=!1;currentUrl="";window=window;constructor(e,r,t,o){this.router=e,this.authService=r,this.storage=t,this.firestore=o,this.router.events.pipe(P(f=>f instanceof T)).subscribe(f=>{this.currentUrl=f.urlAfterRedirects})}ngOnInit(){this.currentUrl=this.router.url,this.loadUserData()}isActiveRoute(e){return this.currentUrl===e||this.currentUrl.startsWith(e)}toggleProfileMenu(e){e.stopPropagation(),this.isProfileMenuOpen=!this.isProfileMenuOpen}closeProfileMenu(){this.isProfileMenuOpen=!1}navigateTo(e){this.router.navigate([e])}logout(){this.authService.signOut().then(()=>{this.router.navigate(["/login"])}).catch(e=>{console.error("Error al cerrar sesi\xF3n:",e)})}openPhotoSelector(){this.isUploading||this.fileInput.nativeElement.click()}onPhotoSelected(e){let r=e.target.files[0];if(r){if(!r.type.includes("image/")){alert("Por favor selecciona una imagen v\xE1lida.");return}this.uploadProfilePhoto(r)}}uploadProfilePhoto(e){if(!this.usuario)return;this.isUploading=!0;let r=q(this.storage,`profile_photos/${this.usuario.IdUsuario}`),t=D(r,e);t.on("state_changed",o=>{let f=o.bytesTransferred/o.totalBytes*100;console.log("Upload is "+f+"% done")},o=>{console.error("Error during upload:",o),this.isUploading=!1,alert("Error al subir la imagen. Por favor, intenta nuevamente.")},()=>{Q(t.snapshot.ref).then(o=>{console.log("File available at",o),this.updateUserProfilePhoto(o)})})}updateUserProfilePhoto(e){if(!this.usuario)return;let r=N(this.firestore,"Usuario",this.usuario.IdUsuario);L(r,{Foto_Perfil:e}).then(()=>{console.log("Foto de perfil actualizada correctamente"),this.usuario&&(this.usuario.Foto_Perfil=e),this.isUploading=!1}).catch(t=>{console.error("Error al actualizar foto de perfil:",t),this.isUploading=!1,alert("Error al actualizar la foto de perfil. Por favor, intenta nuevamente.")})}loadUserData(){this.isLoading=!0,this.authService.getCurrentUser().then(e=>{if(!e)throw new Error("No hay usuario autenticado");return this.authService.getUserData(e.uid)}).then(e=>{if(!e)throw new Error("No se encontraron datos del usuario");this.usuario={IdUsuario:e.IdUsuario,Nombre:e.Nombre,Correo:e.Correo||e.Email||"",Departamento:e.Departamento||"",Foto_Perfil:e.Foto_Perfil||"",NivelAdmin:e.NivelAdmin,createdBy:e.createdBy||e.CreatedBy,Rol:e.Rol||"worker"},this.usuario.Foto_Perfil&&this.preloadImage(this.usuario.Foto_Perfil).catch(()=>{console.warn("No se pudo cargar la imagen de perfil, usando la predeterminada"),this.usuario&&(this.usuario.Foto_Perfil="")}),this.isLoading=!1}).catch(e=>{console.error("Error al cargar datos del usuario:",e),this.router.navigate(["/login"])})}preloadImage(e){return new Promise((r,t)=>{let o=new Image;o.onload=()=>r(),o.onerror=()=>t(),o.src=e})}static \u0275fac=function(r){return new(r||s)(v(W),v(B),v(Y),v(z))};static \u0275cmp=M({type:s,selectors:[["app-worker"]],viewQuery:function(r,t){if(r&1&&O(X,5),r&2){let o;S(o=R())&&(t.fileInput=o.first)}},decls:39,vars:8,consts:[["fileInput",""],[1,"min-h-screen","bg-gradient-to-br","from-indigo-50","to-blue-50","px-4","py-8","md:px-8","md:py-10","lg:px-12"],[1,"max-w-7xl","mx-auto"],[1,"bg-white/95","backdrop-blur-lg","rounded-2xl","shadow-md","p-4","md:p-6","mb-8","md:mb-10","flex","flex-col","sm:flex-row","justify-between","items-center","gap-4","transition-all","duration-300","hover:shadow-lg","hover:-translate-y-1"],[1,"flex","items-center"],["src","icons/logo_RepoS.png","alt","Repo System Logo",1,"h-10","md:h-14","w-auto","mr-3","transition-all","duration-300","hover:scale-105","hover:rotate-2"],[1,"text-2xl","md:text-3xl","font-bold","text-indigo-900","relative"],[1,"absolute","bottom-0","left-0","w-1/3","h-0.5","bg-gradient-to-r","from-indigo-900","to-transparent","rounded","transition-all","duration-300","group-hover:w-full","group-hover:opacity-80"],[1,"flex","items-center","gap-5","z-30"],[1,"text-right","transition-all","duration-200","hover:-translate-y-1"],["class","flex flex-col items-end",4,"ngIf"],["clickOutside","",1,"relative","z-40",3,"clickOutside"],[1,"toggle-button","flex","items-center","p-1.5","rounded-full","bg-indigo-50","transition-all","duration-200","hover:bg-indigo-100","hover:-translate-y-1","hover:shadow-md","active:translate-y-0",3,"click"],["alt","Foto de perfil","onerror",`this.src='icons/default_profile.png'; 
            this.onerror=null;`,1,"w-10","h-10","rounded-full","object-cover","border-2","border-white","shadow-md","transition-all","duration-300","hover:border-indigo-100","hover:scale-105",3,"src"],[1,"text-xs","text-indigo-900","ml-2","transition-transform","duration-300"],["class",`dropdown-menu absolute top-14 right-0 w-72 sm:w-80 bg-white 
          rounded-xl shadow-lg z-50 origin-top-right animate-fadeIn flex flex-col max-h-[450px]`,3,"ngStyle",4,"ngIf"],["class","bg-white rounded-3xl p-4 md:p-6 mb-6 shadow-md transition-all duration-300 hover:shadow-lg",4,"ngIf"],["class","flex flex-col items-center justify-center h-64 z-10",4,"ngIf"],[1,"bg-gradient-to-br","from-gray-800","to-indigo-900","text-white","rounded-3xl","p-6","md:p-8","mt-8","shadow-lg"],[1,"flex","flex-col","md:flex-row","justify-between","gap-6"],[1,"max-w-md"],[1,"text-xl","font-bold","text-indigo-300","mb-3"],[1,"text-gray-300","text-sm","leading-relaxed","mb-4"],[1,"text-indigo-300","font-semibold","mb-2"],[1,"text-gray-300","text-sm"],[1,"mt-6","pt-4","border-t","border-gray-700/50","text-center","text-gray-400","text-xs"],["id","notification-toast",1,"fixed","bottom-5","left-1/2","-translate-x-1/2","py-3","px-5","rounded-xl","text-white","text-sm","font-medium","z-50","shadow-lg","flex","items-center","gap-2.5","transform","transition-all","duration-300","w-11/12","max-w-md","justify-center"],["type","file","accept","image/*",2,"display","none",3,"change"],[1,"flex","flex-col","items-end"],[1,"text-sm","text-gray-600","font-medium","m-0","bg-gradient-to-r","from-gray-500","to-gray-600","bg-clip-text","text-transparent"],[1,"text-indigo-900","font-semibold","truncate","max-w-[150px]","md:max-w-[200px]",3,"title"],[1,"dropdown-menu","absolute","top-14","right-0","w-72","sm:w-80","bg-white","rounded-xl","shadow-lg","z-50","origin-top-right","animate-fadeIn","flex","flex-col","max-h-[450px]",3,"ngStyle"],[1,"p-5","flex","flex-col","items-center","border-b","border-gray-100","bg-gradient-to-br","from-indigo-50","to-blue-50"],[1,"relative","mb-4"],["alt","Foto de perfil","onerror",`this.src='icons/default_profile.png'; 
                this.onerror=null;`,1,"w-24","h-24","rounded-full","object-cover","border-4","border-white","shadow-md","mb-2","transition-all","hover:scale-[1.02]","hover:shadow-lg",3,"src"],["class",`absolute inset-0 flex 
                items-center justify-center`,4,"ngIf"],[1,"bg-indigo-900","text-white","rounded-full","px-3","py-1.5","text-xs","flex","items-center","gap-1.5","transition-all","hover:bg-indigo-800","hover:-translate-y-1","hover:shadow-md","active:translate-y-0","disabled:bg-indigo-400","disabled:cursor-not-allowed","mx-auto",3,"click","disabled"],[1,"fas","fa-camera","text-xs"],["type","file","accept","image/*",1,"hidden",3,"change"],[1,"text-center","w-full"],[1,"text-lg","font-semibold","text-indigo-900","m-0"],[1,"text-sm","bg-indigo-100","text-indigo-800","px-2","py-0.5","rounded-full","inline-block","mt-1","shadow-inner"],[1,"text-sm","text-gray-500","mt-1.5","break-all"],[1,"py-2","overflow-y-auto","flex-grow"],[1,"flex","items-center","px-5","py-3","text-gray-700","transition-all","cursor-pointer","hover:bg-indigo-50","hover:pl-6","group",3,"click"],[1,"fas","fa-cog","text-indigo-900","mr-3","w-5","text-center","transition-transform","duration-200","group-hover:translate-x-1"],[1,"text-sm","font-medium"],[1,"my-1.5","mx-4","border-gray-100"],[1,"flex","items-center","px-5","py-3","text-red-600","transition-all","cursor-pointer","hover:bg-red-50","hover:pl-6","group","mb-1",3,"click"],[1,"fas","fa-sign-out-alt","text-red-600","mr-3","w-5","text-center","transition-transform","duration-200","group-hover:translate-x-1"],[1,"absolute","inset-0","flex","items-center","justify-center"],[1,"w-10","h-10","border-4","border-indigo-200","border-t-indigo-900","rounded-full","animate-spin"],[1,"bg-white","rounded-3xl","p-4","md:p-6","mb-6","shadow-md","transition-all","duration-300","hover:shadow-lg"],[1,"flex","flex-wrap","gap-3","md:gap-5","justify-center","sm:justify-start","overflow-x-auto","py-2"],["routerLink","/worker",1,"px-4","py-2","rounded-lg","transition-all","duration-300","text-sm","md:text-base","font-medium","flex","items-center","gap-2","whitespace-nowrap","cursor-pointer",3,"click"],[1,"fas","fa-home"],["routerLink","/worker-pendingtask",1,"px-4","py-2","rounded-lg","transition-all","duration-300","text-sm","md:text-base","font-medium","flex","items-center","gap-2","whitespace-nowrap","cursor-pointer",3,"click"],[1,"fas","fa-clipboard-list"],["routerLink","/worker-completetask",1,"px-4","py-2","rounded-lg","transition-all","duration-300","text-sm","md:text-base","font-medium","flex","items-center","gap-2","whitespace-nowrap","cursor-pointer",3,"click"],[1,"fas","fa-check-circle"],["routerLink","/worker-statistics",1,"px-4","py-2","rounded-lg","transition-all","duration-300","text-sm","md:text-base","font-medium","flex","items-center","gap-2","whitespace-nowrap","cursor-pointer",3,"click"],[1,"fas","fa-chart-bar"],[1,"flex","flex-col","items-center","justify-center","h-64","z-10"],[1,"w-12","h-12","border-4","border-indigo-200","border-t-indigo-900","rounded-full","mb-5","animate-spin"],[1,"text-gray-700","font-medium","bg-gradient-to-r","from-gray-600","to-gray-500","bg-clip-text","text-transparent","animate-pulse"]],template:function(r,t){if(r&1){let o=w();i(0,"div",1)(1,"div",2)(2,"header",3)(3,"div",4),d(4,"img",5),i(5,"h1",6),a(6," Repo System "),d(7,"span",7),n()(),i(8,"div",8)(9,"div",9),_(10,$,5,2,"div",10)(11,H,3,0,"div",10),n(),i(12,"div",11),p("clickOutside",function(){return c(o),m(t.closeProfileMenu())}),i(13,"button",12),p("click",function(b){return c(o),m(t.toggleProfileMenu(b))}),d(14,"img",13),i(15,"span",14),a(16,"\u25BC"),n()(),_(17,K,28,12,"div",15),n()()(),_(18,Z,18,48,"div",16)(19,ee,4,0,"div",17),d(20,"router-outlet"),i(21,"footer",18)(22,"div",2)(23,"div",19)(24,"div",20)(25,"h3",21),a(26,"Repo System"),n(),i(27,"p",22),a(28,"Un sistema de reporter\xEDa de trabajo de campo que permite a los t\xE9cnicos documentar sus intervenciones laborales de forma completa."),n()(),i(29,"div")(30,"h4",23),a(31,"Desarrollado por"),n(),i(32,"p",24),a(33,"Alberto Castro, Pedro Salda\xF1a y Andy Pesantez"),n()()(),i(34,"div",25),a(35," \xA9 2024 Repo System. Todos los derechos reservados. "),n()()()()(),d(36,"div",26),i(37,"input",27,0),p("change",function(b){return c(o),m(t.onPhotoSelected(b))}),n()}r&2&&(l(10),u("ngIf",t.usuario),l(),u("ngIf",!t.usuario),l(3),u("src",t.usuario&&t.usuario.Foto_Perfil?t.usuario.Foto_Perfil:"icons/default_profile.png",y),l(),x("rotate180",t.isProfileMenuOpen),l(2),u("ngIf",t.isProfileMenuOpen),l(),u("ngIf",!t.isLoading),l(),u("ngIf",t.isLoading))},dependencies:[U,I,A,j,V,F],styles:[`@charset "UTF-8";[_ngcontent-%COMP%]:root{--primary-gradient: linear-gradient(135deg, #3b82f6, #4f46e5);--secondary-gradient: linear-gradient(135deg, #f8f9fe 0%, #f1f4f9 100%);--card-hover-transform: translateY(-8px) rotate3d(1, 1, 0, 2deg);--standard-transition: all .3s cubic-bezier(.4, 0, .2, 1);--hover-shadow: 0 10px 25px -5px rgb(59 130 246 / .1), 0 8px 10px -5px rgb(59 130 246 / .04)}[_nghost-%COMP%]{display:block;min-height:100vh;font-family:ui-sans-serif,system-ui,sans-serif;background:var(--secondary-gradient);color-scheme:light}.rotate180[_ngcontent-%COMP%]{transform:rotate(180deg)}@keyframes _ngcontent-%COMP%_fadeInMenu{0%{opacity:0;transform:scale(.95) translateY(-10px)}to{opacity:1;transform:scale(1) translateY(0)}}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.7}}.animate-fadeIn[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeInMenu .25s cubic-bezier(.175,.885,.32,1.275)}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s cubic-bezier(.6,.2,.4,.8) infinite}.animate-pulse[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 2s infinite}@media (max-width: 640px){.w-72[_ngcontent-%COMP%]{width:18rem}.header[_ngcontent-%COMP%]{padding:1rem}.cards-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}@media (min-width: 641px) and (max-width: 1024px){.cards-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}.hidden[_ngcontent-%COMP%]{display:none}#notification-toast.from-green-600[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#16a34a,#22c55e)}#notification-toast.from-red-600[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#dc2626,#ef4444)}#notification-toast.from-blue-600[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#2563eb,#3b82f6)}#notification-toast.from-yellow-600[_ngcontent-%COMP%]{background-image:linear-gradient(to right,#ca8a04,#eab308)}#notification-toast.opacity-0[_ngcontent-%COMP%]{opacity:0}#notification-toast.translate-y-6[_ngcontent-%COMP%]{transform:translateY(1.5rem) translate(-50%)}.main-nav-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{transition:var(--standard-transition)}.main-nav-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.main-nav-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:active{transform:translateY(0)}.cards-grid[_ngcontent-%COMP%]{perspective:1000px}.cards-grid[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{transform-style:preserve-3d;transition:var(--standard-transition)}.cards-grid[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:hover{transform:var(--card-hover-transform)}.user-dropdown-container[_ngcontent-%COMP%]   .profile-photo-container[_ngcontent-%COMP%]{position:relative;overflow:hidden}.user-dropdown-container[_ngcontent-%COMP%]   .profile-photo-container[_ngcontent-%COMP%]:hover   .photo-overlay[_ngcontent-%COMP%]{opacity:1}.user-dropdown-container[_ngcontent-%COMP%]   .profile-photo-container[_ngcontent-%COMP%]   .photo-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#4f46e566;opacity:0;transition:var(--standard-transition);display:flex;align-items:center;justify-content:center;color:#fff}footer[_ngcontent-%COMP%]{background:linear-gradient(135deg,#374151,#312e81)}footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{transition:var(--standard-transition)}footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#c7d2fe}
/*# sourceMappingURL=worker.component-XBAGW2UE.css.map */`]})}return s})();export{ue as WorkerComponent};
//# sourceMappingURL=chunk-3VY4U66U.js.map
