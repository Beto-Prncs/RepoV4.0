import{K as P,Q as D,W as F}from"./chunk-7XAWW6QG.js";import{m as v}from"./chunk-OLDY7IAS.js";import{B as E,O as y,T as I,Z as u,n as h,p as s,s as b}from"./chunk-GCXAMRXK.js";import{g as d}from"./chunk-OIKEWKHE.js";var f={firebaseConfig:{apiKey:"AIzaSyB02aFRJQaUZV4PH-1UilL0G1qR011UMOo",authDomain:"workflowdb-4122b.firebaseapp.com",projectId:"workflowdb-4122b",storageBucket:"workflowdb-4122b.firebasestorage.app",messagingSenderId:"1053802838055",appId:"1:1053802838055:web:17ffaf05c2fe045c77b602",persistence:"session"},cloudinary:{cloudName:"dqv73l7uc",apiKey:"747314796397951",uploadPreset:"profile_images"}};var $=(()=>{class n{cloudName=f.cloudinary.cloudName;uploadPreset=f.cloudinary.uploadPreset;uploadUrl=`https://api.cloudinary.com/v1_1/${this.cloudName}/image/upload`;http=u(v);firestore=u(P);uploadProfileImage(a,e,i="Usuario"){if(!a||!a.type.includes("image"))return s(()=>new Error("El archivo debe ser una imagen"));if(!e)return s(()=>new Error("ID de usuario no disponible"));let r=new FormData;return r.append("file",a),r.append("upload_preset",this.uploadPreset),r.append("public_id",`user_${e}_${Date.now()}`),this.http.post(this.uploadUrl,r).pipe(y(o=>{let l=o.secure_url,t=D(this.firestore,i,e);return h(F(t,{Foto_Perfil:l})).pipe(b(()=>l))}),E(o=>(console.error("Error al subir imagen:",o),s(()=>new Error("Error al subir imagen: "+(o.message||"Intente nuevamente"))))))}optimizeImage(a,e=500){return d(this,null,function*(){return new Promise((i,r)=>{try{let o=new FileReader;o.onload=l=>{let t=new Image;t.onload=()=>{let p=t.width,c=t.height;p>e&&(c=Math.round(c*e/p),p=e);let m=document.createElement("canvas");m.width=p,m.height=c;let g=m.getContext("2d");if(!g){r(new Error("No se pudo obtener el contexto 2D del canvas"));return}g.drawImage(t,0,0,p,c),m.toBlob(w=>{if(!w){r(new Error("Error al generar blob"));return}let U=new File([w],a.name,{type:"image/jpeg",lastModified:Date.now()});i(U)},"image/jpeg",.85)},t.onerror=()=>{r(new Error("Error al cargar la imagen para optimizaci\xF3n"))},t.src=l.target?.result},o.onerror=()=>{r(new Error("Error al leer el archivo para optimizaci\xF3n"))},o.readAsDataURL(a)}catch(o){r(o)}})})}updateProfileImage(a,e){return d(this,null,function*(){try{let i=yield this.optimizeImage(a);return this.uploadProfileImage(i,e)}catch(i){return s(()=>i)}})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=I({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();export{$ as a};
//# sourceMappingURL=chunk-ZQBMJCPA.js.map
