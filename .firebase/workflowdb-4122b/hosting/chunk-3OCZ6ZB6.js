import{M as l,O as y,P as u,Q as o,R as w,S as D,U as n,X as i,Z as q,_ as c}from"./chunk-ETTNRBRS.js";import{U as f,_ as h,s as d}from"./chunk-RQ52NV5F.js";import{g as m}from"./chunk-OIKEWKHE.js";var g=(()=>{class a{firestore=h(l);getDepartments(){let r=o(this.firestore,"Departamento");return y(r,{idField:"IdDepartamento"}).pipe(d(e=>e.map(t=>({IdDepartamento:t.IdDepartamento,Nombre:t.Nombre,id:t.IdDepartamento,name:t.Nombre}))))}addDepartment(r){return m(this,null,function*(){try{let e=o(this.firestore,"Departamento"),t=i(e,c("Nombre","==",r));if(!(yield n(t)).empty)throw new Error("Ya existe un departamento con este nombre");let s=r.toLowerCase().trim().replace(/\s+/g,"_"),p={IdDepartamento:s,Nombre:r};return yield u(o(this.firestore,"Departamento"),p),s}catch(e){throw console.error("Error al a\xF1adir departamento:",e),e}})}deleteDepartment(r){return m(this,null,function*(){try{let e=o(this.firestore,"Usuario"),t=i(e,c("Departamento","==",r));if(!(yield n(t)).empty)throw new Error("No se puede eliminar el departamento porque hay usuarios asignados a \xE9l");let s=i(o(this.firestore,"Departamento"),c("IdDepartamento","==",r)),p=yield n(s);if(p.empty)throw new Error("Departamento no encontrado");yield w(D(this.firestore,"Departamento",p.docs[0].id))}catch(e){throw console.error("Error al eliminar departamento:",e),e}})}static \u0275fac=function(e){return new(e||a)};static \u0275prov=f({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var Q=(()=>{class a{firestore=h(l);getCompanies(){let r=o(this.firestore,"Empresa");return y(r,{idField:"IdEmpresa"}).pipe(d(e=>e))}addCompany(r){return m(this,null,function*(){try{let e=o(this.firestore,"Empresa"),t=i(e,c("Nombre","==",r.Nombre));if(!(yield n(t)).empty)throw new Error("Ya existe una empresa con este nombre");let s=yield u(o(this.firestore,"Empresa"),r);return yield q(s,{IdEmpresa:s.id}),s.id}catch(e){throw console.error("Error al a\xF1adir empresa:",e),e}})}deleteCompany(r){return m(this,null,function*(){try{let e=o(this.firestore,"Reportes"),t=i(e,c("IdEmpresa","==",r));if(!(yield n(t)).empty)throw new Error("No se puede eliminar la empresa porque hay reportes asociados a ella");let s=i(o(this.firestore,"Empresa"),c("IdEmpresa","==",r)),p=yield n(s);if(p.empty)throw new Error("Empresa no encontrada");yield w(D(this.firestore,"Empresa",p.docs[0].id))}catch(e){throw console.error("Error al eliminar empresa:",e),e}})}static \u0275fac=function(e){return new(e||a)};static \u0275prov=f({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();export{g as a,Q as b};
//# sourceMappingURL=chunk-3OCZ6ZB6.js.map
