import{a as $}from"./chunk-RT2AZM63.js";import"./chunk-NOIAGMWN.js";import{L as z,P as V,Q as B,R as F,T as N,V as j,Y as G}from"./chunk-SLGRDKNT.js";import{c as T,d as D,e as I,g as A,k as L,u as R}from"./chunk-ZX2O5KE6.js";import{Ab as d,Bb as S,Eb as g,Fb as p,Mb as r,Nb as b,Ob as w,Ta as o,Yb as E,Z as h,Zb as C,bb as U,g as M,ga as y,gb as f,ha as _,ia as u,ja as v,na as k,ob as l,yb as t,zb as i}from"./chunk-ISKDQYGU.js";import{g as x}from"./chunk-OIKEWKHE.js";function H(n,c){if(n&1&&(t(0,"div",33),u(),t(1,"svg",34),d(2,"path",35),i(),r(3),i()),n&2){let e=p();o(3),w(" ",e.errorMessage," ")}}function q(n,c){if(n&1&&(t(0,"div",36),u(),t(1,"svg",34),d(2,"path",37),i(),r(3),i()),n&2){let e=p();o(3),w(" ",e.successMessage," ")}}function O(n,c){n&1&&(t(0,"div",38),u(),t(1,"svg",39),d(2,"circle",40)(3,"path",41),i(),v(),t(4,"span",42),r(5,"Cargando..."),i()())}function P(n,c){if(n&1){let e=S();t(0,"tr",43)(1,"td",44),r(2),i(),t(3,"td",45),r(4),i(),t(5,"td",45),r(6),i(),t(7,"td",45)(8,"span",46),r(9),i()(),t(10,"td",45),r(11),i(),t(12,"td",47)(13,"button",48),g("click",function(){let s=y(e).$implicit,m=p();return _(m.showDeleteConfirmation(s))}),r(14," Eliminar "),i()()()}if(n&2){let e=c.$implicit,a=p();o(2),b(e.Nombre),o(2),b(e.Username),o(2),b(e.Correo),o(2),l("ngClass",e.Rol==="admin"?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"),o(),w(" ",e.Rol==="admin"?"Administrador":"Trabajador"," "),o(2),w(" ",e.Rol==="admin"?"Nivel "+e.NivelAdmin:e.Departamento," "),o(2),l("disabled",a.isLoading)}}function J(n,c){n&1&&(t(0,"tr")(1,"td",49),r(2,"No hay usuarios disponibles"),i()())}function K(n,c){n&1&&(t(0,"span"),r(1,"Eliminar"),i())}function Q(n,c){n&1&&(t(0,"span",70),u(),t(1,"svg",71),d(2,"circle",40)(3,"path",41),i(),r(4," Eliminando... "),i())}function W(n,c){if(n&1){let e=S();t(0,"div",50)(1,"div",51)(2,"div",52),d(3,"div",53),i(),t(4,"span",54),r(5,"\u200B"),i(),t(6,"div",55)(7,"div",56)(8,"div",57)(9,"div",58),u(),t(10,"svg",59),d(11,"path",60),i()(),v(),t(12,"div",61)(13,"h3",62),r(14,"Confirmar eliminaci\xF3n"),i(),t(15,"div",63)(16,"p",64),r(17," \xBFEst\xE1 seguro de eliminar al usuario "),t(18,"span",65),r(19),i(),r(20,"? Esta acci\xF3n no se puede deshacer. "),i()()()()(),t(21,"div",66)(22,"button",67),g("click",function(){y(e);let s=p();return _(s.confirmDelete())}),f(23,K,2,0,"span",31)(24,Q,5,0,"span",68),i(),t(25,"button",69),g("click",function(){y(e);let s=p();return _(s.cancelDelete())}),r(26," Cancelar "),i()()()()()}if(n&2){let e=p();o(19),b(e.userToDelete==null?null:e.userToDelete.Nombre),o(3),l("disabled",e.isLoading),o(),l("ngIf",!e.isLoading),o(),l("ngIf",e.isLoading),o(),l("disabled",e.isLoading)}}var oe=(()=>{class n{authService=h($);firestore=h(z);router=h(R);destroyRef=h(k);users$=new M([]);isAdmin3=!1;isLoading=!1;currentAdminId="";showConfirmDialog=!1;userToDelete=null;errorMessage="";successMessage="";filterRole="all";constructor(){}ngOnInit(){return x(this,null,function*(){yield this.checkAdminPermissions(),this.loadUsers()})}checkAdminPermissions(){return x(this,null,function*(){try{let e=yield this.authService.getCurrentUser();if(!e){this.router.navigate(["/login"]);return}let a=yield this.authService.getUserData(e.uid);if(!a||a.Rol!=="admin"){this.router.navigate(["/admin1"]);return}this.isAdmin3=a.NivelAdmin==="3",this.currentAdminId=e.uid,this.isAdmin3||this.router.navigate(["/admin1"])}catch(e){console.error("Error verificando permisos:",e),this.showError("Error al verificar permisos de administrador"),this.router.navigate(["/admin1"])}})}loadUsers(e="all"){this.isLoading=!0,this.filterRole=e,this.fetchUsers(e)}fetchUsers(e="all"){return x(this,null,function*(){try{let a=yield this.authService.getUsersCreatedBy(this.currentAdminId),s=a;e!=="all"&&(s=a.filter(m=>m.Rol===e)),this.users$.next(s)}catch(a){console.error("Error cargando usuarios:",a),this.showError("Error al cargar usuarios")}finally{this.isLoading=!1}})}showDeleteConfirmation(e){this.userToDelete=e,this.showConfirmDialog=!0}cancelDelete(){this.userToDelete=null,this.showConfirmDialog=!1}confirmDelete(){return x(this,null,function*(){if(this.userToDelete){this.isLoading=!0;try{if(this.userToDelete.Rol==="worker"){let a=V(this.firestore,"Reportes"),s=j(a,G("IdUsuario","==",this.userToDelete.Username));if(!(yield N(s)).empty)throw new Error("No se puede eliminar el usuario porque tiene reportes asignados")}let e=this.userToDelete.IdUsuario;yield B(F(this.firestore,"Usuario",e)),this.showSuccess(`Usuario "${this.userToDelete.Nombre}" eliminado correctamente`),this.cancelDelete(),this.loadUsers(this.filterRole)}catch(e){this.showError(e.message||"Error al eliminar usuario")}finally{this.isLoading=!1}}})}goBack(){this.router.navigate(["/admin1"])}setFilter(e){this.loadUsers(e)}showError(e){this.errorMessage=e,this.successMessage="",setTimeout(()=>this.errorMessage="",5e3)}showSuccess(e){this.successMessage=e,this.errorMessage="",setTimeout(()=>this.successMessage="",3e3)}static \u0275fac=function(a){return new(a||n)};static \u0275cmp=U({type:n,selectors:[["app-manage-users"]],decls:54,vars:13,consts:[[1,"min-h-screen","bg-gradient-to-br","from-gray-50","to-blue-50","py-6","sm:py-12","px-4"],[1,"group","mb-6","inline-flex","items-center","px-4","py-2","bg-blue-600","text-white","rounded-lg","transition-all","shadow-md","hover:bg-blue-700","hover:shadow-lg","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"w-5","h-5","mr-2","transition-transform","group-hover:-translate-x-1"],["x1","19","y1","12","x2","5","y2","12"],["points","12 19 5 12 12 5"],[1,"max-w-6xl","mx-auto"],[1,"bg-white","rounded-2xl","shadow-xl","overflow-hidden","border","border-gray-200","transition-all","duration-300","transform","hover:shadow-2xl"],[1,"bg-gradient-to-r","from-blue-600","via-blue-500","to-blue-700","p-8","relative","overflow-hidden"],[1,"absolute","inset-0","overflow-hidden","opacity-10"],[1,"absolute","-top-24","-left-24","w-96","h-96","rounded-full","bg-white/20"],[1,"absolute","-bottom-24","-right-24","w-96","h-96","rounded-full","bg-white/20"],[1,"flex","flex-col","md:flex-row","items-center","md:items-start","gap-5","relative","z-10"],[1,"bg-white","p-4","rounded-xl","shadow-lg","transform","transition-all","duration-300","hover:rotate-3","hover:scale-105","ring-4","ring-white/30"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-12","w-12","text-blue-500"],["d","M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"],[1,"text-center","md:text-left"],[1,"text-white","text-3xl","font-bold","tracking-tight","drop-shadow-md"],[1,"text-blue-100","mt-2","text-lg","font-light","tracking-wide"],["class","mx-8 mt-4 p-4 bg-red-50 text-red-700 rounded-lg border-l-4 border-red-500 flex items-start",4,"ngIf"],["class","mx-8 mt-4 p-4 bg-green-50 text-green-700 rounded-lg border-l-4 border-green-500 flex items-start",4,"ngIf"],["class","mx-8 mt-4 p-4 bg-blue-50 rounded-lg flex items-center justify-center",4,"ngIf"],[1,"p-8"],[1,"mb-6","flex","flex-wrap","gap-2"],[1,"px-4","py-2","rounded-lg","transition-colors","focus:outline-none","focus:ring-2","focus:ring-offset-2",3,"click","ngClass"],[1,"bg-white","rounded-lg","border","border-gray-200","overflow-hidden"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],["scope","col",1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],["scope","col",1,"px-6","py-3","text-right","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-gray-200"],["class","hover:bg-gray-50",4,"ngFor","ngForOf"],[4,"ngIf"],["class","fixed inset-0 z-50 overflow-y-auto",4,"ngIf"],[1,"mx-8","mt-4","p-4","bg-red-50","text-red-700","rounded-lg","border-l-4","border-red-500","flex","items-start"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20","fill","currentColor",1,"h-5","w-5","mr-2","flex-shrink-0"],["fill-rule","evenodd","d","M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zm-1 9a1 1 0 01-1-1v-4a1 1 0 112 0v4a1 1 0 01-1 1z","clip-rule","evenodd"],[1,"mx-8","mt-4","p-4","bg-green-50","text-green-700","rounded-lg","border-l-4","border-green-500","flex","items-start"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],[1,"mx-8","mt-4","p-4","bg-blue-50","rounded-lg","flex","items-center","justify-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5","text-blue-600","mr-3"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"text-blue-600","font-medium"],[1,"hover:bg-gray-50"],[1,"px-6","py-4","whitespace-nowrap","text-sm","font-medium","text-gray-900"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-500"],[1,"px-2","inline-flex","text-xs","leading-5","font-semibold","rounded-full",3,"ngClass"],[1,"px-6","py-4","whitespace-nowrap","text-right","text-sm","font-medium"],[1,"text-red-600","hover:text-red-900","focus:outline-none","focus:underline",3,"click","disabled"],["colspan","6",1,"px-6","py-4","text-center","text-sm","text-gray-500"],[1,"fixed","inset-0","z-50","overflow-y-auto"],[1,"flex","items-center","justify-center","min-h-screen","pt-4","px-4","pb-20","text-center","sm:block","sm:p-0"],["aria-hidden","true",1,"fixed","inset-0","transition-opacity"],[1,"absolute","inset-0","bg-gray-500","opacity-75"],["aria-hidden","true",1,"hidden","sm:inline-block","sm:align-middle","sm:h-screen"],[1,"inline-block","align-bottom","bg-white","rounded-lg","text-left","overflow-hidden","shadow-xl","transform","transition-all","sm:my-8","sm:align-middle","sm:max-w-lg","sm:w-full"],[1,"bg-white","px-4","pt-5","pb-4","sm:p-6","sm:pb-4"],[1,"sm:flex","sm:items-start"],[1,"mx-auto","flex-shrink-0","flex","items-center","justify-center","h-12","w-12","rounded-full","bg-red-100","sm:mx-0","sm:h-10","sm:w-10"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","aria-hidden","true",1,"h-6","w-6","text-red-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"],[1,"mt-3","text-center","sm:mt-0","sm:ml-4","sm:text-left"],[1,"text-lg","leading-6","font-medium","text-gray-900"],[1,"mt-2"],[1,"text-sm","text-gray-500"],[1,"font-medium"],[1,"bg-gray-50","px-4","py-3","sm:px-6","sm:flex","sm:flex-row-reverse"],["type","button",1,"w-full","inline-flex","justify-center","rounded-md","border","border-transparent","shadow-sm","px-4","py-2","bg-red-600","text-base","font-medium","text-white","hover:bg-red-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-red-500","sm:ml-3","sm:w-auto","sm:text-sm",3,"click","disabled"],["class","flex items-center",4,"ngIf"],["type","button",1,"mt-3","w-full","inline-flex","justify-center","rounded-md","border","border-gray-300","shadow-sm","px-4","py-2","bg-white","text-base","font-medium","text-gray-700","hover:bg-gray-50","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","sm:mt-0","sm:ml-3","sm:w-auto","sm:text-sm",3,"click","disabled"],[1,"flex","items-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","-ml-1","mr-2","h-4","w-4","text-white"]],template:function(a,s){if(a&1&&(t(0,"div",0)(1,"button",1),g("click",function(){return s.goBack()}),u(),t(2,"svg",2),d(3,"line",3)(4,"polyline",4),i(),r(5," Atr\xE1s "),i(),v(),t(6,"div",5)(7,"div",6)(8,"div",7)(9,"div",8),d(10,"div",9)(11,"div",10),i(),t(12,"div",11)(13,"div",12),u(),t(14,"svg",13),d(15,"path",14),i()(),v(),t(16,"div",15)(17,"h1",16),r(18,"Gesti\xF3n de Usuarios"),i(),t(19,"p",17),r(20,"Administrar usuarios creados por usted"),i()()()(),f(21,H,4,1,"div",18)(22,q,4,1,"div",19)(23,O,6,0,"div",20),t(24,"div",21)(25,"div",22)(26,"button",23),g("click",function(){return s.setFilter("all")}),r(27," Todos los usuarios "),i(),t(28,"button",23),g("click",function(){return s.setFilter("admin")}),r(29," Administradores "),i(),t(30,"button",23),g("click",function(){return s.setFilter("worker")}),r(31," Trabajadores "),i()(),t(32,"div",24)(33,"table",25)(34,"thead",26)(35,"tr")(36,"th",27),r(37,"Nombre"),i(),t(38,"th",27),r(39,"Username"),i(),t(40,"th",27),r(41,"Correo"),i(),t(42,"th",27),r(43,"Rol"),i(),t(44,"th",27),r(45,"Nivel/Dpto"),i(),t(46,"th",28),r(47,"Acciones"),i()()(),t(48,"tbody",29),f(49,P,15,7,"tr",30),E(50,"async"),f(51,J,3,0,"tr",31),E(52,"async"),i()()()()()(),f(53,W,27,5,"div",32),i()),a&2){let m;o(21),l("ngIf",s.errorMessage),o(),l("ngIf",s.successMessage),o(),l("ngIf",s.isLoading),o(3),l("ngClass",s.filterRole==="all"?"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500":"bg-gray-100 text-gray-700 hover:bg-gray-200 focus:ring-gray-400"),o(2),l("ngClass",s.filterRole==="admin"?"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500":"bg-gray-100 text-gray-700 hover:bg-gray-200 focus:ring-gray-400"),o(2),l("ngClass",s.filterRole==="worker"?"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500":"bg-gray-100 text-gray-700 hover:bg-gray-200 focus:ring-gray-400"),o(19),l("ngForOf",C(50,9,s.users$)),o(2),l("ngIf",((m=C(52,11,s.users$))==null?null:m.length)===0),o(2),l("ngIf",s.showConfirmDialog)}},dependencies:[L,T,D,I,A],encapsulation:2})}return n})();export{oe as ManageUsersComponent};
//# sourceMappingURL=chunk-IOPIN324.js.map
